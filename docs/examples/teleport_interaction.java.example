import com.hypixel.hytale.codec.KeyedCodec;
import com.hypixel.hytale.codec.builder.BuilderCodec;
import com.hypixel.hytale.component.CommandBuffer;
import com.hypixel.hytale.component.Ref;
import com.hypixel.hytale.protocol.InteractionState;
import com.hypixel.hytale.protocol.InteractionType;
import com.hypixel.hytale.protocol.Vector3f;
import com.hypixel.hytale.server.core.codec.ProtocolCodecs;
import com.hypixel.hytale.server.core.entity.InteractionContext;
import com.hypixel.hytale.server.core.modules.entity.component.TransformComponent;
import com.hypixel.hytale.server.core.modules.interaction.interaction.CooldownHandler;
import com.hypixel.hytale.server.core.modules.interaction.interaction.config.SimpleInstantInteraction;
import com.hypixel.hytale.server.core.universe.world.storage.EntityStore;
import javax.annotation.Nonnull;
public class TeleportInteraction extends SimpleInstantInteraction {
public static final BuilderCodec<TeleportInteraction> CODEC =
((BuilderCodec.Builder) BuilderCodec.builder(
TeleportInteraction.class,
TeleportInteraction::new,
SimpleInstantInteraction.CODEC) // Inherit parent codec
.appendInherited(
new KeyedCodec<>("Destination", ProtocolCodecs.VECTOR3F),
(i, v) -> i.destination.assign(v.x, v.y, v.z),
i -> new Vector3f(i.destination.x, i.destination.y, i.destination.z),
(i, parent) -> i.destination = parent.destination) // Inheritance handler
.add())
.build();
private com.hypixel.hytale.math.vector.Vector3f destination =
new com.hypixel.hytale.math.vector.Vector3f(0, 0, 0);
@Override
protected void firstRun(@Nonnull InteractionType type,
@Nonnull InteractionContext context,
@Nonnull CooldownHandler cooldownHandler) {
Ref<EntityStore> entity = context.getEntity();
CommandBuffer<EntityStore> buffer = context.getCommandBuffer();
TransformComponent transform = buffer.getComponent(entity, TransformComponent.getComponentType());
if (transform != null) {
transform.setPosition(destination.x, destination.y, destination.z);
context.getState().state = InteractionState.Finished;
} else {
context.getState().state = InteractionState.Failed;
}
}
}